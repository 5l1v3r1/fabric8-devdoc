sudo: required

branches:
  only:
    - master

services:
  - docker

before_install:
  - TRAVIS_ENABLED=true

script:
  - if [ "$TRAVIS_BRANCH" = "master" -a "$TRAVIS_PULL_REQUEST" = "false" ]; then bash generate.sh; else true; fi

after_error:
  - docker logs asciidoc-to-html

after_failure:
  - docker logs asciidoc-to-html

after_success:
  # public html_site to 'gh-pages' branch   
  - if [ "$TRAVIS_BRANCH" = "master" -a "$TRAVIS_PULL_REQUEST" = "false" ]; then
      sudo cp CNAME output/docs; 
      cd output/docs;
      sudo git init;
      sudo git config user.name "${GH_USER}";
      sudo git config user.email "${GH_EMAIL}";
      sudo git add .;
      sudo git commit -m "GitHub pages generated by travis-ci.org for commit $TRAVIS_COMMIT";
      sudo git push --force --quiet "https://${GH_TOKEN}@github.com/fabric8-services/fabric8-devdoc" master:gh-pages > /dev/null 2>&1;
    fi
